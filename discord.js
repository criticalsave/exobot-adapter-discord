require("source-map-support").install();
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@exoplay/exobot"),require("discord.js")):"function"==typeof define&&define.amd?define(["@exoplay/exobot","discord.js"],t):"object"==typeof exports?exports["discord.js"]=t(require("@exoplay/exobot"),require("discord.js")):e["discord.js"]=t(e["@exoplay/exobot"],e["discord.js"])}(this,function(e,t){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,t,r){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t){e.exports=require("@exoplay/exobot")},function(e,t){e.exports=require("discord.js")},function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,i){try{var u=t[o](i),a=u.value}catch(c){return void r(c)}return u.done?void e(a):Promise.resolve(a).then(function(e){return n("next",e)},function(e){return n("throw",e)})}return n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(1),c=a&&a.__esModule?function(){return a["default"]}:function(){return a};r.d(c,"a",c);var s=r(0),d=s&&s.__esModule?function(){return s["default"]}:function(){return s};r.d(d,"a",d),r.d(t,"EVENTS",function(){return p}),r.d(t,"DISCORD_MENTION_REGEX",function(){return h}),r.d(t,"DiscordAdapter",function(){return b});var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=function y(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var o=Object.getPrototypeOf(e);return null===o?void 0:y(o,t,r)}if("value"in n)return n.value;var i=n.get;if(void 0!==i)return i.call(r)},p={ready:"discordReady",message:"discordMessage",reconnecting:"discordReconnecting"},h=/<@!(\d+)>/i,b=function(e){function t(e){var r=e.token,n=e.botId,u=e.username,a=e.adapterName;e.roleMapping;o(this,t);var c=i(this,Object.getPrototypeOf(t).apply(this,arguments));return c.name="discord",c.channels={},c.discordReady=function(){c.status=s.Adapter.STATUS.CONNECTED,c.bot.emitter.emit("connected",c.name),c.bot.log.notice("Connected to Discord."),c.client.user.game="Exobotting",c.client.guilds.forEach(function(e){e.member(c.client.user).nickname=c.bot.name})},c.discordReconnecting=function(){c.status=s.Adapter.STATUS.DISCONNECTED,c.bot.log.critical("Reconnecting to Discord.")},c.name=a||c.name,c.botId=n,c.username=u,c.token=r,c}return u(t,e),l(t,[{key:"register",value:function(e){var r=this;f(Object.getPrototypeOf(t.prototype),"register",this).apply(this,arguments);var n=this.token,o=this.botId,i=this.username;return n&&o&&i?(this.client=new c.a.Client,Object.keys(p).forEach(function(e){var t=r[p[e]];r.client.on(e,function(){return t.bind(r).apply(void 0,arguments)}),r.client.on(e,function(){for(var t,n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];(t=r.bot.emitter).emit.apply(t,["discord-"+e].concat(o))})}),void this.client.login(n)):(this.status=s.Adapter.STATUS.ERROR,void e.log.error("token, botId, and username are required to connect to discord."))}},{key:"send",value:function(e){this.bot.log.debug("Sending "+e.text+" to "+e.channel),e.channel.sendMessage(e.text)}},{key:"getUserIdByUserName",value:function(){function e(e){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function r(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t=this.client.users.find("username",e),!t){r.next=15;break}return n=void 0,r.prev=3,r.next=6,this.getUser(t.id,t.username,t);case 6:n=r.sent,r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](3),this.bot.log.warn(r.t0);case 12:return r.abrupt("return",n.id);case 15:return r.abrupt("return");case 16:case"end":return r.stop()}},r,this,[[3,9]])}));return e}()},{key:"getRoleIdByRoleName",value:function(e,t){var r=t.channel.guild.roles.find("name",e);if(r)return r.id}},{key:"getRolesForUser",value:function(e){var t=this;return this.roleMapping&&this.adapterUsers&&this.adapterUsers[e]?this.adapterUsers[e].roles.filter(function(e){return t.roleMapping[e]}).map(function(e){return t.roleMapping[e]}):[]}},{key:"discordMessage",value:function(){function e(e){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function o(e){var r,n=e.channel,i=(e.guild,e.author),u=e.content,a=e.member;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i.username!==this.username){e.next=2;break}return e.abrupt("return");case 2:return this.bot.log.debug(u),e.next=5,this.getUser(i.id,i.username,a||i);case 5:if(r=e.sent,"dm"!==n.type){e.next=8;break}return e.abrupt("return",f(Object.getPrototypeOf(t.prototype),"receiveWhisper",this).call(this,{user:r,text:u,channel:n}));case 8:this.receive({user:r,text:u,channel:n});case 9:case"end":return e.stop()}},o,this)}));return e}()},{key:"getRoles",value:function(e,t){return!!t.roles&&t.roles.map(function(e){return e.name})}}]),t}(s.Adapter)}])});
//# sourceMappingURL=discord.js.map